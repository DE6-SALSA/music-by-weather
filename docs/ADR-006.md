# ADR-006: [Parquet 압축 코덱 선택]

📅 날짜: 2025-07-25

### 💡 고려된 옵션

1. **Snappy**
2. **Gzip**
3. **Zstd (Zstandard)**
4. **Brotli**
5. **LZO / LZ4**

### ✅ 결정

Parquet 파일 압축 코덱으로 **Snappy**를 채택

### 🏷️ 근거

- **Redshift COPY 및 Athena/Glue, Spark, Pandas 등과의 호환성이 가장 좋음**
- **빠른 압축·해제 속도**로 ETL에서 성능 저하를 최소화
- 압축률은 Gzip이나 Zstd보다 낮지만, **S3 I/O 비용과 COPY 속도를 모두 고려하면 최적의 선택**
- AWS 공식 문서에서도 Redshift COPY 시 Snappy가 권장되는 경우가 많음

### 📊 옵션 비교

| 코덱 | 압축률 | 압축/해제 속도 | Redshift COPY 지원 | 특징 |
| --- | --- | --- | --- | --- |
| **Snappy** | 중간 | 매우 빠름 | ✅ 완전 지원 | 성능/호환성 균형 좋음 |
| **Gzip** | 높음 | 느림 | ✅ 지원 | 압축률 우수하지만 CPU 부담 큼 |
| **Zstd** | 높음~매우 높음 | 중간~빠름 | ✅ 지원 (최근) | 최신 코덱, 압축률 좋고 속도도 빠름 |
| **Brotli** | 매우 높음 | 매우 느림 | ❌ (Redshift 미지원) | 웹용 최적화, 비실용적 |
| **LZO/LZ4** | 낮음~중간 | 빠름 | ⚠️ 일부 지원 제한 | Spark/Hadoop 환경에서 주로 사용 |

### 💬 추가 참고사항

- **파일 크기 최소화가 최우선**이라면 → **Zstd(level=3~5)** 추천
- **CPU 리소스가 제한적이고 빠른 처리**가 중요하다면 → **Snappy** 유지
- Redshift COPY는 Snappy/Zstd/Gzip 모두 지원하지만,
    
    Snappy가 **가장 일반적으로 사용되고 안정적**임
    

### 🔄 대안

추후 **데이터 볼륨이 매우 커져서 S3 비용 절감이 더 중요**해진다면,

**Zstd로 전환**하는 방안을 검토할 수 있음. Zstd는 Parquet 기본 코덱으로 빠르게 확산 중임

 **현재는 Snappy 채택 → 향후 벤치마크 후 Zstd 고려**라는 전략이 합리적.
