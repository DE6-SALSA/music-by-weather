# ADR-005: [웹, 앱 서비스 yaml 작성]

**📅 날짜**: 2025-07-24

**🧩 주제**

**FastAPI는 기존 Airflow용 `docker-compose.yaml`에 포함시키고, Streamlit은 별도의 Compose로 분리한 구성 선택**

**💡 고려된 옵션**

1. 모든 서비스(FastAPI, Streamlit, Airflow)를 하나의 `docker-compose.yaml`로 구성
2. FastAPI는 기존 Airflow Compose에 포함, Streamlit만 별도 Compose 파일로 분리
3. 모든 서비스를 완전히 별도의 Compose 파일로 독립 구성

**✅ 결정**

**FastAPI는 기존 Airflow Compose 파일(`docker-compose.yaml`)에 포함하고, Streamlit은 별도 Compose(`docker-compose-streamlit.yaml`)로 분리하여 구성**

**🏷️ 근거**

### 📌 FastAPI를 기존 Compose에 포함한 이유

- **백엔드 기반 컴포넌트들과 밀접한 연관**
    
    FastAPI는 Airflow, Redis, Postgres 등 백엔드 서비스들과 긴밀히 연동되며, 동일 네트워크와 환경변수 설정을 공유해야 함.
    
- **개발자·배포자 관점에서의 응집력 유지**
    
    Airflow DAG에서 FastAPI를 호출하거나, FastAPI가 백엔드 DB(Postgres 등)에 접근할 일이 많음 → 같은 Compose에서 관리하면 연결 관리가 쉬움.
    
- **프라이빗 네트워크 상에 함께 배포됨**
    
    Airflow, FastAPI 모두 프라이빗 EC2에 위치하며 같은 보안그룹과 내부 IP 대역을 공유 → 구성 상 자연스럽게 한 Compose로 묶는 것이 적절
    

### 📌 Streamlit을 별도 Compose로 분리한 이유

- **배포 위치 및 목적이 다름**
    
    Streamlit은 퍼블릭 EC2에서 사용자 인터페이스(UI)를 제공하고, FastAPI는 프라이빗 EC2에서 API를 제공 → 물리적으로 분리된 인프라에 배포되므로 함께 Compose에 포함하는 것이 부적절.
    
- **라이프사이클, 변경 주기 차이**
    
    Streamlit은 프론트엔드로서 시각화 코드나 UI 구성의 변경이 잦고, FastAPI는 백엔드 로직으로 구조가 안정적 → 관리 주기가 다르므로 독립 관리가 효율적.
    
- **불필요한 의존성 제거**
    
    FastAPI가 없어도 Streamlit 자체는 단독 실행 가능 (e.g. 시각화 테스트, UI 개발 등) → 굳이 무거운 백엔드 종속성을 포함할 필요 없음.
    
- **배포 유연성 확보**
    
    CI/CD에서 `streamlit`만 따로 build/deploy 하거나, 퍼블릭 인스턴스에서만 실행 가능하게 하려면 Compose 분리가 필요
    

**🛠️ 기술 구성 요약**

| 구분 | 배포 위치 | Compose 구성 | 포함된 서비스 |
| --- | --- | --- | --- |
| `docker-compose.yaml` | Private EC2 | 기존 Airflow용 | airflow, fastapi, redis, postgres |
| `docker-compose-streamlit.yaml` | Public EC2 | 별도 작성 | streamlit only |

**💬 추가 참고사항**

- `.env` 파일에서 `FASTAPI_BASE_URL`을 내부 IP로 설정해 Streamlit ↔ FastAPI 통신을 보장
- 추후 오케스트레이션 도입(ECS, EKS 등)을 고려할 경우, 현재 구조는 각 서비스의 **서비스 단위 배포 기준**으로 확장 가능함
- Airflow ↔ FastAPI 연계, Streamlit ↔ FastAPI 호출 테스트 모두 `docker compose` 내에서 컨트롤 가능한 수준으로 유지
